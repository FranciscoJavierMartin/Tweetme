{% extends "base.html" %} {% block head_title %} Home {% endblock head_title %}
{% block content %}

<div class='row text-center'>
  <div class='col'>
    <h1>Welcome to tweetme
  </div>
</div>

<div class='row mb-3'>
  <div class='col-md-4 mx-auto col-10'>
    <form class="form" method="POST" action='/create-tweet'>
      {% csrf_token %}
      <input type="hidden" value="/" name="next"/>
      <textarea class="form-control" name="content" placeholder="Write your tweet" ></textarea>
      <button type="submit" class="btn btn-primary">Tweet</button>
    </form>
  </div>
</div>

<div class='row' id="tweets"></div>

<script>
  function handleDidLike(tweet_id, currentCount) {
    currentCount++;
  }

  function likeBtn(tweet) {
    return `<button class='btn btn-primary' 
      onclick=handleDidLike(${tweet.id}, ${tweet.likes})>
        Like
      </button>`;
  }

  function formatTweetElement(accumulator, tweet) {
    return `${accumulator}
      <div class='col-12 mb-4' id='tweet-${tweet.id}'>
        <h3>${tweet.id}</h1>
        <div class='btn-group'>${tweet.content} ${likeBtn(tweet)}</div>
      </div>`;
  }

  const tweetsElement = document.getElementById('tweets');
  tweetsElement.innerHTML = 'Loading...';

  const xhr = new XMLHttpRequest();
  const method = 'GET';
  const url = '/tweets';
  const responseType = 'json';

  xhr.responseType = responseType;
  xhr.open(method, url);
  xhr.onload = function () {
    var listedItems = xhr.response.response;
    tweetsElement.innerHTML = listedItems.reduce(formatTweetElement, '');
  };
  xhr.onerror = () => {
    console.log('error');
  };
  xhr.send();
</script>

{% endblock content %}
